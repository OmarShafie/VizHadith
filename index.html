<html>
  <head>
    <title>Viz Hadith</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.0.2/papaparse.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.0.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="processing.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['sankey']});
      function drawChart(data) {
        
        // Sets chart options.
        var options = {
          width: 1920,
          height: 700,
          sankey: {
            iterations: 100,
            node: {
               //nodePadding: 80,
              label: { fontName: 'Times-Roman',
                         fontSize: 12,
                         italic: true }
            },
          }
        };

  var chartDiv = document.getElementById('sankey_basic');
  var chart = new google.visualization.Sankey(chartDiv);
        
        var colorMap = {};
        var textIndex = 0;
        var rectIndex = 0;
        var pathIndex = 0;
  var observer = new MutationObserver(function (mutations) {
    mutations.forEach(function (mutation) {
      mutation.addedNodes.forEach(function (node) {
        if (node.tagName === 'text') {
          colorMap[textIndex] = gradeToColor(getNarratorGrade(node.innerHTML));
          textIndex++;
        }
        if (node.tagName === 'rect') {
          node.setAttribute('fill', colorMap[rectIndex]);
          rectIndex++;
        }
      });
    });
  });
        
  observer.observe(chartDiv, {
    childList: true,
    subtree: true
  });

        chart.draw(data, options);
      }
    </script>
  </head>
  <body>
    <h1 class="text-center">Hadith Visualizer</h1>
    <h2 class="text-center small">Visual Analysis of hadith narration chains.</h2>
    
  <div >
    <div class="form-inline justify-content-around">
      <label for="rawi">Rawi Id:</label>
      <input type="text" class="form-control" id="rawi" required placeholder=11013>
      <label for="numNarrators">Number of Links:</label>
      <input type="number" class="form-control" id="numNarrators" placeholder=100>
      
    <button type="button" id="submit" class="btn btn-primary"> Submit</button>
    </div>
    
      <label id="btnMessage"></label>
        <div id="sankey_basic" ></div>
    </div>
  </body>
</html>
